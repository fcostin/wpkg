<?xml version="1.0" encoding="UTF-8"?>

<!--
NOTES
 1) We always remove the Apple Update package no matter what as it might be left over from previous installations
 2) We are now also removing the scheduled task that runs the updater
 3) The Bonjour package is no longer installed by default, but can easily be installed by adding the "bonjour" package to a profile
-->

<packages>

<package
  id="itunes"
  name="Apple iTunes"
  revision="%version%-0"
  reboot="false"
  priority="10">

  <depends package-id="applesupport" />
  <depends package-id="applemobile" />
  <!--
  <depends package-id="bonjour" />
  -->
  <depends package-id="quicktime" />

  <variable name="version" value="10.0.1.22" />
  <variable name="pkg32" value="%SOFTWARE%\Apple\iTunes_10.0.1.22\iTunes.msi" />
  <variable name="pkg64" value="%SOFTWARE%\Apple\iTunes_10.0.1.22\iTunes64.msi" />

  <check type="uninstall" condition="versiongreaterorequal" path="iTunes" value="%version%"/>

  <install cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "x86"   msiexec %MSI% /i "%pkg32%"' />
  <install cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" msiexec %MSI% /i "%pkg64%"' />
  <install cmd='msiexec %MSI% /x "%SOFTWARE%\Apple\iTunes_10.0.1.22\AppleSoftwareUpdate.msi"'>
    <exit code="1605" />
    <exit code="0" />
  </install>
  <install cmd='REG DELETE "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run" /v iTunesHelper /f'>
    <exit code="1" />
  </install>
  <install cmd='schtasks /delete AppleSoftwareUpdate /f'>
    <exit code="1" />
  </install>

  <upgrade cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "x86"   msiexec %MSI% /i "%pkg32%"'>
    <exit code="any" />
  </upgrade>
  <upgrade cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" msiexec %MSI% /i "%pkg64%"'>
    <exit code="any" />
  </upgrade>
  <upgrade cmd='msiexec %MSI% /x "%SOFTWARE%\Apple\iTunes_10.0.1.22\AppleSoftwareUpdate.msi"'>
    <exit code="1605" />
    <exit code="0" />
  </upgrade>
  <upgrade cmd='REG DELETE "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run" /v iTunesHelper /f'>
    <exit code="1" />
  </upgrade>
  <upgrade cmd='schtasks /delete AppleSoftwareUpdate /f'>
    <exit code="1" />
  </upgrade>

  <downgrade cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "x86"   msiexec %MSI% /i "%pkg32%"'>
    <exit code="any" />
  </downgrade>
  <downgrade cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" msiexec %MSI% /i "%pkg64%"'>
    <exit code="any" />
  </downgrade>
  <downgrade cmd='msiexec %MSI% /x "%SOFTWARE%\Apple\iTunes_10.0.1.22\AppleSoftwareUpdate.msi"'>
    <exit code="1605" />
    <exit code="0" />
  </downgrade>
  <downgrade cmd='REG DELETE "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run" /v iTunesHelper /f'>
    <exit code="1" />
  </downgrade>
  <downgrade cmd='schtasks /delete AppleSoftwareUpdate /f'>
    <exit code="1" />
  </downgrade>

  <remove  cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "x86"   msiexec %MSI% /x "%pkg32%"'>
    <exit code="3010" />
  </remove>
  <remove  cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" msiexec %MSI% /x "%pkg64%"'>
    <exit code="3010" />
  </remove>
  <remove  cmd='msiexec %MSI% /x "%SOFTWARE%\Apple\iTunes_10.0.1.22\AppleSoftwareUpdate.msi"'>
    <exit code="1605" />
    <exit code="0" />
  </remove>
</package>

<package
  id="applemobile"
  name="Apple Mobile Device Support"
  revision="%version%-0"
  reboot="false"
  priority="10">

  <variable name="version" value="3.2.0.47" />
  <variable name="pkg32" value="%SOFTWARE%\Apple\iTunes_10.0.1.22\AppleMobileDeviceSupport.msi" />
  <variable name="pkg64" value="%SOFTWARE%\Apple\iTunes_10.0.1.22\AppleMobileDeviceSupport64.msi" />

  <check type="uninstall"  condition="versiongreaterorequal" path="Apple Mobile Device Support" value="%version%"/>
  <install cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "x86"   msiexec %MSI% /i "%pkg32%"' />
  <install cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" msiexec %MSI% /i "%pkg64%"' />
  <upgrade cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "x86"   msiexec %MSI% /i "%pkg32%"' />
  <upgrade cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" msiexec %MSI% /i "%pkg64%"' />
  <remove  cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "x86"   msiexec %MSI% /x "%pkg32%"' />
  <remove  cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" msiexec %MSI% /x "%pkg64%"' />
</package>

<package
  id="applesupport"
  name="Apple Software Application Support"
  revision="%version%-1"
  reboot="false"
  priority="10">

  <variable name="version" value="1.3.2" />
  <variable name="pkg32" value="%SOFTWARE%\Apple\iTunes_10.0.1.22\AppleApplicationSupport.msi" />

  <check type="uninstall"  condition="versiongreaterorequal" path="Apple Application Support" value="%version%"/>
  <install cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "x86"   msiexec %MSI% /i "%pkg32%"' />
  <install cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" msiexec %MSI% /i "%pkg32%"' />
  <upgrade cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "x86"   msiexec %MSI% /i "%pkg32%"' />
  <upgrade cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" msiexec %MSI% /i "%pkg32%"' />
  <remove  cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "x86"   msiexec %MSI% /x "%pkg32%"' />
  <remove  cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" msiexec %MSI% /x "%pkg32%"' />
</package>

<package
  id="bonjour"
  name="Bonjour"
  revision="%version%-0"
  reboot="false"
  priority="10">

  <variable name="version" value="2.0.3.0" />
  <variable name="pkg32" value="%SOFTWARE%\Apple\iTunes_10.0.1.22\bonjour.msi" />
  <variable name="pkg64" value="%SOFTWARE%\Apple\iTunes_10.0.1.22\bonjour64.msi" />

  <check type="uninstall" condition="versiongreaterorequal" path="Bonjour" value="%version%"/>
  <install cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "x86"   msiexec %MSI% /i "%pkg32%"' />
  <install cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" msiexec %MSI% /i "%pkg64%"' />
  <upgrade cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "x86"   msiexec %MSI% /i "%pkg32%"' />
  <upgrade cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" msiexec %MSI% /i "%pkg64%"' />
  <remove  cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "x86"   msiexec %MSI% /x "%pkg32%"' />
  <remove  cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" msiexec %MSI% /x "%pkg64%"' />
</package>

<package
  id="quicktime"
  name="Apple Quicktime"
  revision="%version%-0"
  reboot="false"
  priority="10">

  <variable name="version" value="7.68.75.0" />
  <variable name="pkg32" value="%SOFTWARE%\Apple\iTunes_10.0.1.22\QuickTime.msi" />
  <variable name="RUN" value="HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run" />

  <check type="uninstall" condition="versiongreaterorequal" path="QuickTime" value="%version%"/>

  <install cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "x86"   msiexec %MSI% /i "%pkg32%"' />
  <install cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" msiexec %MSI% /i "%pkg32%"' />
  <install cmd='REG DELETE %RUN% /v "QuickTime Task" /f'>
    <exit code="1" />
  </install>
  <install cmd='%COMSPEC% /c del /F /Q "%ALLUSERSPROFILE%\Desktop\QuickTime Player.lnk"'>
    <exit code="1" />
  </install>

  <upgrade cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "x86"   msiexec %MSI% /i "%pkg32%"' />
  <upgrade cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" msiexec %MSI% /i "%pkg32%"' />
  <upgrade cmd='REG DELETE %RUN% /v "QuickTime Task" /f'>
    <exit code="1" />
  </upgrade>
  <upgrade cmd='%COMSPEC% /c del /F /Q "%ALLUSERSPROFILE%\Desktop\QuickTime Player.lnk"'>
    <exit code="1" />
  </upgrade>

  <downgrade cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "x86"   msiexec %MSI% /i "%pkg32%"' />
  <downgrade cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" msiexec %MSI% /i "%pkg32%"' />
  <downgrade cmd='REG DELETE %RUN% /v "QuickTime Task" /f'>
    <exit code="1" />
  </downgrade>
  <downgrade cmd='%COMSPEC% /c del /F /Q "%ALLUSERSPROFILE%\Desktop\QuickTime Player.lnk"'>
    <exit code="1" />
  </downgrade>

  <remove  cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "x86"   msiexec %MSI% /x "%pkg32%"' />
  <remove  cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" msiexec %MSI% /x "%pkg32%"' />
</package>

<package
  id="iphone_config"
  name="Apple iPhone Configuration Utility"
  revision="%version%-0"
  reboot="false"
  priority="10">

  <depends package-id="applesupport" />
  <depends package-id="applemobile" />
  <!-- Must check this
  <depends package-id="bonjour" />
  -->

  <variable name="version" value="3.1.0.256" />

  <check type="uninstall" condition="versiongreaterorequal" path="iPhone Configuration Utility" value="%version%"/>

  <install cmd='msiexec %MSI% /i "%SOFTWARE%\Apple\iPhone_3\iPhoneConfigUtility.msi"' />
  <install cmd='msiexec %MSI% /x "%SOFTWARE%\Apple\iPhone_3\AppleSoftwareUpdate.msi"'>
    <exit code="1605" />
    <exit code="0" />
  </install>
  <install cmd='schtasks /delete AppleSoftwareUpdate /f'>
    <exit code="1" />
  </install>

  <upgrade cmd='msiexec %MSI% /i "%SOFTWARE%\Apple\iPhone_3\iPhoneConfigUtility.msi"' />
  <upgrade cmd='msiexec %MSI% /x "%SOFTWARE%\Apple\iPhone_3\AppleSoftwareUpdate.msi"'>
    <exit code="1605" />
    <exit code="0" />
  </upgrade>
  <upgrade cmd='schtasks /delete AppleSoftwareUpdate /f'>
    <exit code="1" />
  </upgrade>

  <remove  cmd='msiexec %MSI% /x "%SOFTWARE%\Apple\iPhone_3\iPhoneConfigUtility.msi"' />
  <remove  cmd='msiexec %MSI% /x "%SOFTWARE%\Apple\iPhone_3\AppleSoftwareUpdate.msi"'>
    <exit code="1605" />
    <exit code="0" />
  </remove>
  <remove  cmd='schtasks /delete AppleSoftwareUpdate /f'>
    <exit code="1" />
  </remove>
</package>

</packages>

<?xml version="1.0" encoding="UTF-8"?>

<!--
  NOTES
  1) For version 2, there are now only two installers - one for 32 and another for 64 bit
  2) All installers are named mssefullinstall.exe - rename them to _x32 and _x64 
  3) The platform/bitness specific packages now only depend on the generic msse package - they are left in for backwards compatibility
  4) Installer will throw -2147156187 if a reboot is needed before it can installed again - this is NOT success

-->

<packages>

<package
  id="msse"
  name="MS Security Essentials"
  revision="%version%-0"
  reboot="false"
  priority="50">

  <variable name='version' value='2.0.657.0' />

  <check type="uninstall" condition="versiongreaterorequal" path="Microsoft Security Essentials" value="%version%" />

  <install cmd='net stop MsMpSvc'><exit code="2" /></install>
  <install cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "x86" "%SOFTWARE%\MSSE\mssefullinstall_x32.exe" /s /runwgacheck'>
    <exit code="-2147156221" />
    <exit code="-2147156213" />
    <exit code="327424" />
  </install>
  <install cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" "%SOFTWARE%\MSSE\mssefullinstall_x64.exe" /s /runwgacheck'>
    <exit code="-2147156221" />
    <exit code="-2147156213" />
    <exit code="327424" />
  </install>
  <install cmd='%COMSPEC% /c del "%ALLUSERSPROFILE%\Desktop\Microsoft*.lnk"' />
  <install cmd='net start MsMpSvc' />

  <upgrade cmd='net stop MsMpSvc'><exit code="2" /></upgrade>
  <upgrade cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "x86" "%SOFTWARE%\MSSE\mssefullinstall_x32.exe" /s /runwgacheck'>
    <exit code="-2147156221" />
    <exit code="-2147156213" />
    <exit code="327424" />
  </upgrade>
  <upgrade cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" "%SOFTWARE%\MSSE\mssefullinstall_x64.exe" /s /runwgacheck'>
    <exit code="-2147156221" />
    <exit code="-2147156213" />
    <exit code="327424" />
  </upgrade>
  <upgrade cmd='%COMSPEC% /c del "%ALLUSERSPROFILE%\Desktop\Microsoft*.lnk"' />
  <upgrade cmd='net start MsMpSvc' />

  <downgrade cmd='net stop MsMpSvc'><exit code="2" /></downgrade>
  <downgrade cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "x86" "%SOFTWARE%\MSSE\mssefullinstall_x32.exe" /s /runwgacheck'>
    <exit code="-2147156221" />
    <exit code="-2147156213" />
    <exit code="327424" />
  </downgrade>
  <downgrade cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" "%SOFTWARE%\MSSE\mssefullinstall_x64.exe" /s /runwgacheck'>
    <exit code="-2147156221" />
    <exit code="-2147156213" />
    <exit code="327424" />
  </downgrade>
  <downgrade cmd='%COMSPEC% /c del "%ALLUSERSPROFILE%\Desktop\Microsoft*.lnk"' />
  <downgrade cmd='net start MsMpSvc' />

  <remove cmd='%COMSPEC% /c IF EXIST "%PROGRAMFILES%\Microsoft Security Essentials\setup.exe" "%PROGRAMFILES%\Microsoft Security Essentials\setup.exe" /x /s' />

</package>


<package
  id="msse_xp_32"
  name="MS Security Essentials"
  revision="99"
  reboot="false"
  priority="50">

  <depends package-id="msse" />
  
</package>

<package
  id="msse_w7_32"
  name="MS Security Essentials"
  revision="99"
  reboot="false"
  priority="50">

  <depends package-id="msse" />

</package>

<package
  id="msse_w7_64"
  name="MS Security Essentials"
  revision="99"
  reboot="false"
  priority="50">

  <depends package-id="msse" />

</package>

</packages>

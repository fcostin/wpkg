<?xml version="1.0" encoding="UTF-8"?>

<!--
  NOTES
  1) This is no elegant way (that I know of) to turn this into one installer for all platforms (xp32, win7_32, win7_64)
  2) Installer will throw -2147156187 if a reboot is needed before it can installed again - this is NOT success

  PACKAGES
  mssefullinstall-x86fre-en-us-xp.exe
  mssefullinstall-x86fre-en-us-vista-win7.exe
  mssefullinstall-amd64fre-en-us-vista-win7.exe
  

-->

<packages>

<package
  id="msse_xp_32"
  name="MS Security Essentials"
  revision="%version%-5"
  reboot="false"
  priority="50">

  <variable name='version' value='1.0.2498.0' />

  <check type="uninstall" condition="versiongreaterorequal" path="Microsoft Security Essentials" value="%version%" />

  <install cmd='net stop MsMpSvc'><exit code="2" /></install>
  <install cmd='"%SOFTWARE%\MSSE\mssefullinstall-x86fre-en-us-xp.exe" /s /runwgacheck'>
    <exit code="-2147156221" />
    <exit code="-2147156213" />
    <exit code="327424" />
  </install>
  <install cmd='%COMSPEC% /c del "%ALLUSERSPROFILE%\Desktop\Microsoft*.lnk"' />
  <install cmd='net start MsMpSvc' />

  <upgrade cmd='net stop MsMpSvc'><exit code="2" /></upgrade>
  <upgrade cmd='"%SOFTWARE%\MSSE\mssefullinstall-x86fre-en-us-xp.exe" /s /runwgacheck'>
    <exit code="-2147156221" />
    <exit code="-2147156213" />
    <exit code="327424" />
  </upgrade>
  <upgrade cmd='%COMSPEC% /c del "%ALLUSERSPROFILE%\Desktop\Microsoft*.lnk"' />
  <upgrade cmd='net start MsMpSvc' />

  <downgrade cmd='net stop MsMpSvc'><exit code="2" /></downgrade>
  <downgrade cmd='"%SOFTWARE%\MSSE\mssefullinstall-x86fre-en-us-xp.exe" /s /runwgacheck'>
    <exit code="-2147156221" />
    <exit code="-2147156213" />
    <exit code="327424" />
  </downgrade>
  <downgrade cmd='%COMSPEC% /c del "%ALLUSERSPROFILE%\Desktop\Microsoft*.lnk"' />
  <downgrade cmd='net start MsMpSvc' />

  <remove cmd='%COMSPEC% /c IF EXIST "%PROGRAMFILES%\Microsoft Security Essentials\setup.exe" "%PROGRAMFILES%\Microsoft Security Essentials\setup.exe" /x /s' />

</package>

<package
  id="msse_w7_32"
  name="MS Security Essentials"
  revision="%version%-5"
  reboot="false"
  priority="50">

  <variable name='version' value='1.0.2498.0' />
  <check type="uninstall" condition="versiongreaterorequal" path="Microsoft Security Essentials" value="%version%" />

    <install cmd='net stop MsMpSvc'><exit code="2" /></install>
    <install cmd='"%SOFTWARE%\MSSE\mssefullinstall-x86fre-en-us-vista-win7.exe" /s /runwgacheck'>
      <exit code="-2147156221" />
      <exit code="-2147156213" />
      <exit code="327424" />
    </install>
    <install cmd='%COMSPEC% /c del "%ALLUSERSPROFILE%\Desktop\Microsoft*.lnk"' />
    <install cmd='net start MsMpSvc' />

    <upgrade cmd='net stop MsMpSvc'><exit code="2" /></upgrade>
    <upgrade cmd='"%SOFTWARE%\MSSE\mssefullinstall-x86fre-en-us-vista-win7.exe" /s /runwgacheck'>
      <exit code="-2147156221" />
      <exit code="-2147156213" />
      <exit code="327424" />
    </upgrade>
    <upgrade cmd='%COMSPEC% /c del "%ALLUSERSPROFILE%\Desktop\Microsoft*.lnk"' />
    <upgrade cmd='net start MsMpSvc' />

    <downgrade cmd='net stop MsMpSvc'><exit code="2" /></downgrade>
    <downgrade cmd='"%SOFTWARE%\MSSE\mssefullinstall-x86fre-en-us-vista-win7.exe" /s /runwgacheck'>
      <exit code="-2147156221" />
      <exit code="-2147156213" />
      <exit code="327424" />
    </downgrade>
    <downgrade cmd='%COMSPEC% /c del "%ALLUSERSPROFILE%\Desktop\Microsoft*.lnk"' />
    <downgrade cmd='net start MsMpSvc' />

    <remove cmd='%COMSPEC% /c IF EXIST "%PROGRAMFILES%\Microsoft Security Essentials\setup.exe" "%PROGRAMFILES%\Microsoft Security Essentials\setup.exe" /x /s' />

</package>

<package
  id="msse_w7_64"
  name="MS Security Essentials"
  revision="%version%-5"
  reboot="false"
  priority="50">

  <variable name='version' value='1.0.2498.0' />
  <check type="uninstall" condition="versiongreaterorequal" path="Microsoft Security Essentials" value="%version%" />

  <install cmd='net stop MsMpSvc'><exit code="2" /></install>
  <install cmd='"%SOFTWARE%\MSSE\mssefullinstall-amd64fre-en-us-vista-win7.exe" /s /runwgacheck'>
    <exit code="-2147156221" />
    <exit code="-2147156213" />
    <exit code="327424" />
  </install>
  <install cmd='%COMSPEC% /c del "%ALLUSERSPROFILE%\Desktop\Microsoft*.lnk"' />
  <install cmd='net start MsMpSvc' />

  <upgrade cmd='net stop MsMpSvc'><exit code="2" /></upgrade>
  <upgrade cmd='"%SOFTWARE%\MSSE\mssefullinstall-amd64fre-en-us-vista-win7.exe" /s /runwgacheck'>
    <exit code="-2147156221" />
    <exit code="-2147156213" />
    <exit code="327424" />
  </upgrade>
  <upgrade cmd='%COMSPEC% /c del "%ALLUSERSPROFILE%\Desktop\Microsoft*.lnk"' />
  <upgrade cmd='net start MsMpSvc' />

  <downgrade cmd='net stop MsMpSvc'><exit code="2" /></downgrade>
  <downgrade cmd='"%SOFTWARE%\MSSE\mssefullinstall-amd64fre-en-us-vista-win7.exe" /s /runwgacheck'>
    <exit code="-2147156221" />
    <exit code="-2147156213" />
    <exit code="327424" />
  </downgrade>
  <downgrade cmd='%COMSPEC% /c del "%ALLUSERSPROFILE%\Desktop\Microsoft*.lnk"' />
  <downgrade cmd='net start MsMpSvc' />

  <remove cmd='%COMSPEC% /c IF EXIST "%PROGRAMFILES%\Microsoft Security Essentials\setup.exe" "%PROGRAMFILES%\Microsoft Security Essentials\setup.exe" /x /s' />

</package>

</packages>

<?xml version="1.0" encoding="UTF-8"?>

<packages>
  <package
    id="7zip"
    name="7-Zip (32 and 64 bit)"
    revision="%version%-1"
    reboot="false"
    priority="0">

    <variable name="version" value="9.20" />
    <variable name="fileversion" value="920" />

    <check type="logical" condition="or">
      <check type="uninstall" condition="exists" path="7-Zip %version%"/>
      <check type="uninstall" condition="exists" path="7-Zip %version% (x64 edition)" />
    </check>

    <install cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "x86"   msiexec /i "%SOFTWARE%\7zip\7z%fileversion%.msi" %MSI%'>
      <exit code="3010" />
    </install>

    <install cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" msiexec /i "%SOFTWARE%\7zip\7z%fileversion%-x64.msi" %MSI%'>
      <exit code="3010" />
    </install>
    <install cmd='regedit /s "%SOFTWARE\7zip\7zip.reg"'/>

    <upgrade cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "x86"   msiexec /i "%SOFTWARE%\7zip\7z%fileversion%.msi" %MSI%'>
      <exit code="3010" />
    </upgrade>
    <upgrade cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" msiexec /i "%SOFTWARE%\7zip\7z%fileversion%-x64.msi" %MSI%'>
      <exit code="3010" />
    </upgrade>
    <upgrade cmd='regedit /s "%SOFTWARE\7zip\7zip.reg"'/>

    <downgrade cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "x86"   msiexec /i "%SOFTWARE%\7zip\7z%fileversion%.msi" %MSI%'>
      <exit code="3010" />
    </downgrade>
    <downgrade cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" msiexec /i "%SOFTWARE%\7zip\7z%fileversion%-x64.msi" %MSI%'>
      <exit code="3010" />
    </downgrade>
    <downgrade cmd='regedit /s "%SOFTWARE\7zip\7zip.reg"'/>

    <remove  cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "x86"   msiexec /x "%SOFTWARE%\7zip\7z%fileversion%.msi" %MSI%'>
      <exit code="3010" />
    </remove>
    <remove  cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" msiexec /x "%SOFTWARE%\7zip\7z%fileversion%-x64.msi" %MSI%'>
      <exit code="3010" />
    </remove>
  </package>

  <package
    id="7zipbeta"
    name="7-Zip BETA (32 and 64 bit)"
    revision="%version%-1"
    reboot="false"
    priority="0">

    <variable name="version" value="9.17" />
    <variable name="fileversion" value="917" />

    <check type="logical" condition="or">
      <check type="uninstall" condition="exists" path="7-Zip %version% beta"/>
      <check type="uninstall" condition="exists" path="7-Zip %version% (x64 edition)" /> <!-- No beta on the 64-bit version. Why? No clue. -->
    </check>

    <install cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "x86"   "%SOFTWARE%\7zip\7z%fileversion%.exe" /S' />
    <install cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" msiexec /i "%SOFTWARE%\7zip\7z%fileversion%-x64.msi" %MSI%' />
    <install cmd='regedit /s "%SOFTWARE\7zip\7zip.reg"'/>

    <upgrade cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "x86"   "%SOFTWARE%\7zip\7z%fileversion%.exe" /S' />
    <upgrade cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" msiexec /i "%SOFTWARE%\7zip\7z%fileversion%-x64.msi" %MSI%' />
    <upgrade cmd='regedit /s "%SOFTWARE\7zip\7zip.reg"'/>

    <downgrade cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "x86"   "%SOFTWARE%\7zip\7z%fileversion%.msi" /S' />
    <downgrade cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" msiexec /i "%SOFTWARE%\7zip\7z%fileversion%-x64.msi" %MSI%' />
    <downgrade cmd='regedit /s "%SOFTWARE\7zip\7zip.reg"'/>

    <remove  cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "x86"   "%PROGRAMFILES%\7-Zip\uninstall.exe" /S' />
    <remove  cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" msiexec /x "%SOFTWARE%\7zip\7z%fileversion%-x64.msi" %MSI%' />
  </package>

</packages>

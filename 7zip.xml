<?xml version="1.0" encoding="UTF-8"?>

<packages>
  <package
    id="7zip"
    name="7-Zip (32 and 64 bit)"
    revision="%version%-5"
    reboot="false"
    priority="0">

    <variable name="version" value="9.20" />
    <variable name="fileversion" value="920" />

    <check type="logical" condition="or">
      <check type="uninstall" condition="exists" path="7-Zip %version%"/>
      <check type="uninstall" condition="exists" path="7-Zip %version% (x64 edition)" />
    </check>

    <install cmd='msiexec /i "%SOFTWARE%\7zip\%PROCESSOR_ARCHITECTURE%\7z%fileversion%.msi" %MSI%'>
      <exit code="3010" />
    </install>
    <install cmd='%COMSPEC% /c IF EXIST "%SOFTWARE%\7zip\7zip.reg" regedit /s "%SOFTWARE%\7zip\7zip.reg"'/>
    <install cmd='%COMSPEC% /c IF EXIST "%SOFTWARE%\7zip\7zip.cmd" "%SOFTWARE%\7zip\7zip.cmd"'/>

    <upgrade cmd='msiexec /i "%SOFTWARE%\7zip\%PROCESSOR_ARCHITECTURE%\7z%fileversion%.msi" %MSI%'>
      <exit code="3010" />
    </upgrade>
    <upgrade cmd='%COMSPEC% /c IF EXIST "%SOFTWARE%\7zip\7zip.reg" regedit /s "%SOFTWARE%\7zip\7zip.reg"'/>
    <upgrade cmd='%COMSPEC% /c IF EXIST "%SOFTWARE%\7zip\7zip.cmd" "%SOFTWARE%\7zip\7zip.cmd"'/>

    <downgrade cmd='msiexec /i "%SOFTWARE%\7zip\%PROCESSOR_ARCHITECTURE%\7z%fileversion%.msi" %MSI%'>
      <exit code="3010" />
    </downgrade>
    <downgrade cmd='%COMSPEC% /c IF EXIST "%SOFTWARE%\7zip\7zip.reg" regedit /s "%SOFTWARE%\7zip\7zip.reg"'/>
    <downgrade cmd='%COMSPEC% /c IF EXIST "%SOFTWARE%\7zip\7zip.cmd" "%SOFTWARE%\7zip\7zip.cmd"'/>

    <remove  cmd='msiexec /x "%SOFTWARE%\7zip\%PROCESSOR_ARCHITECTURE%\7z%fileversion%.msi" %MSI%'>
      <exit code="3010" />
    </remove>
  </package>

  <package
    id="7zipbeta"
    name="7-Zip BETA (32 and 64 bit)"
    revision="%version%-0"
    reboot="false"
    priority="0">

    <variable name="version" value="9.21" />
    <variable name="fileversion" value="921" />

    <check type="logical" condition="or">
      <check type="uninstall" condition="exists" path="7-Zip %version% beta"/>
      <check type="uninstall" condition="exists" path="7-Zip %version% (x64 edition)" /> <!-- No beta on the 64-bit version. Why? No clue. -->
    </check>

    <install cmd='msiexec /i "%SOFTWARE%\7zip\%PROCESSOR_ARCHITECTURE%\7z%fileversion%.msi" %MSI%'>
      <exit code="3010" />
    </install>
    <install cmd='%COMSPEC% /c IF EXIST "%SOFTWARE%\7zip\7zip.reg" regedit /s "%SOFTWARE%\7zip\7zip.reg"'/>
    <install cmd='%COMSPEC% /c IF EXIST "%SOFTWARE%\7zip\7zip.cmd" "%SOFTWARE%\7zip\7zip.cmd"'/>

    <upgrade cmd='msiexec /i "%SOFTWARE%\7zip\%PROCESSOR_ARCHITECTURE%\7z%fileversion%.msi" %MSI%'>
      <exit code="3010" />
    </upgrade>
    <upgrade cmd='%COMSPEC% /c IF EXIST "%SOFTWARE%\7zip\7zip.reg" regedit /s "%SOFTWARE%\7zip\7zip.reg"'/>
    <upgrade cmd='%COMSPEC% /c IF EXIST "%SOFTWARE%\7zip\7zip.cmd" "%SOFTWARE%\7zip\7zip.cmd"'/>

    <downgrade cmd='msiexec /i "%SOFTWARE%\7zip\%PROCESSOR_ARCHITECTURE%\7z%fileversion%.msi" %MSI%'>
      <exit code="3010" />
    </downgrade>
    <downgrade cmd='%COMSPEC% /c IF EXIST "%SOFTWARE%\7zip\7zip.reg" regedit /s "%SOFTWARE%\7zip\7zip.reg"'/>
    <downgrade cmd='%COMSPEC% /c IF EXIST "%SOFTWARE%\7zip\7zip.cmd" "%SOFTWARE%\7zip\7zip.cmd"'/>

    <remove  cmd='msiexec /x "%SOFTWARE%\7zip\%PROCESSOR_ARCHITECTURE%\7z%fileversion%.msi" %MSI%'>
      <exit code="3010" />
    </remove>
  </package>

</packages>

<?xml version="1.0" encoding="UTF-8"?>

<packages>

<package
  id="citrix_cag"
  name="Citrix Client Access Gateway"
  revision="1"
  reboot="false"
  priority="10">

  <check type="uninstall" condition="exists" path="Citrix Access Gateway Plugin" />

  <install   cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "x86"   msiexec /i "%SOFTWARE%\Citrix\cagse.msi" %MSI%' />
  <install   cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" msiexec /i "%SOFTWARE%\Citrix\cagse.msi" %MSI%' />
  <install   cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" msiexec /i "%SOFTWARE%\Citrix\cagse-x64.msi" %MSI%' />
  <install   cmd='REG ADD "HKLM\Software\Microsoft\Windows NT\CurrentVersion\AppCompatFlags" /v "{5042648C-F439-468D-859B-6CD12BA02D3A}" /t REG_DWORD /d 1 /f' />

  <upgrade   cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "x86"   msiexec /i "%SOFTWARE%\Citrix\cagse.msi" %MSI%' />
  <upgrade   cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" msiexec /i "%SOFTWARE%\Citrix\cagse.msi" %MSI%' />
  <upgrade   cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" msiexec /i "%SOFTWARE%\Citrix\cagse-x64.msi" %MSI%' />
  <upgrade   cmd='REG ADD "HKLM\Software\Microsoft\Windows NT\CurrentVersion\AppCompatFlags" /v "{5042648C-F439-468D-859B-6CD12BA02D3A}" /t REG_DWORD /d 1 /f' />

  <downgrade cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "x86"   msiexec /i "%SOFTWARE%\Citrix\cagse.msi" %MSI%' />
  <downgrade cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" msiexec /i "%SOFTWARE%\Citrix\cagse.msi" %MSI%' />
  <downgrade cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" msiexec /i "%SOFTWARE%\Citrix\cagse-x64.msi" %MSI%' />
  <downgrade cmd='REG ADD "HKLM\Software\Microsoft\Windows NT\CurrentVersion\AppCompatFlags" /v "{5042648C-F439-468D-859B-6CD12BA02D3A}" /t REG_DWORD /d 1 /f' />

  <remove    cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "x86"   msiexec /x "%SOFTWARE%\Citrix\cagse.msi" %MSI%' />
  <remove    cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" msiexec /x "%SOFTWARE%\Citrix\cagse.msi" %MSI%' />
  <remove    cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" msiexec /x "%SOFTWARE%\Citrix\cagse-x64.msi" %MSI%' />
  <remove    cmd='REG DELETE "HKLM\Software\Microsoft\Windows NT\CurrentVersion\AppCompatFlags" /v "{5042648C-F439-468D-859B-6CD12BA02D3A}" /f' />

</package>

<package
  id="citrix_web"
  name="Citrix Web ICA Client"
  revision="3"
  reboot="false"
  priority="10">

  <check type="uninstall" condition="exists" path="Citrix online plug-in - web" />
  <install cmd='"%SOFTWARE%\Citrix\CitrixOnlinePluginWeb.exe" /silent /norestart' />
  <upgrade cmd='"%SOFTWARE%\Citrix\CitrixOnlinePluginWeb.exe" /silent /norestart' />
  <remove  cmd='"%ALLUSERSPROFILE%\Application Data\Citrix\Citrix online plug-in - web\TrolleyExpress.exe" /uninstall /cleanup' />

</package>

<package
  id="citrix_xen"
  name="Citrix XenApp Client"
  revision="4"
  reboot="false"
  priority="10">

  <check type="logical" condition="or">
    <check type="uninstall" condition="exists" path="Citrix XenApp Plugin for Hosted Apps" />
    <check type="uninstall" condition="exists" path="Citrix XenApp Plugin fÃ¼r gehostete Anwendungen" />
  </check>

  <install cmd='taskkill /f /im iexplore.exe'>
    <exit code="0" />
    <exit code="1" />
    <exit code="128" />
  </install>
  <install cmd='taskkill /f /im firefox.exe'>
    <exit code="0" />
    <exit code="1" />
    <exit code="128" />
  </install>
  <install cmd='taskkill /f /im pnamain.exe'>
    <exit code="0" />
    <exit code="1" />
    <exit code="128" />
  </install>
  <install cmd='msiexec %MSI% /i "%SOFTWARE%\Citrix\XenAppHosted.msi" ADDLOCAL=PN,SSON ENABLE_SSON=Yes ALLOW_REBOOT=No'>
    <exit code="3010" reboot="postponed" />
  </install>
  <upgrade cmd='taskkill /f /im iexplore.exe'>
    <exit code="0" />
    <exit code="1" />
    <exit code="128" />
  </upgrade>
  <upgrade cmd='taskkill /f /im firefox.exe'>
    <exit code="0" />
    <exit code="1" />
    <exit code="128" />
  </upgrade>
  <upgrade cmd='taskkill /f /im pnamain.exe'>
    <exit code="0" />
    <exit code="1" />
    <exit code="128" />
  </upgrade>
  <upgrade cmd='msiexec %MSI% /i "%SOFTWARE%\Citrix\XenAppHosted.msi" ADDLOCAL=PN,SSON ENABLE_SSON=Yes ALLOW_REBOOT=No'>
    <exit code="3010" reboot="postponed" />
  </upgrade>
  <remove  cmd='msiexec %MSI% /x "%SOFTWARE%\Citrix\XenAppHosted.msi"' />

</package>

</packages>

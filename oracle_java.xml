<?xml version="1.0" encoding="UTF-8"?>

<!--
  NOTES
  1) Download from: http://www.oracle.com/technetwork/java/javase/downloads/index.html
  2) We install both 32-bit and 64-bit JRE on 64-bit hosts
  3) 32-bit installations on 64-bit is broken when using the .exe installer - you NEED to get the .cab and .msi from the 32 bit installer for 64 bit platforms
  4) install/up/downgrade must all remove the CURRENT VERSION before installing it as installing on top of the same version leaves the package in an inconsistent state
  5) we now loop through the versions to perform uninstall which also lets us remove old 64 bit versions
-->

<packages>

<package
  id="java"
  name="Java 6"
  revision="%version%-4"
  reboot="false"
  priority="10">

  <variable name="short" value="6u27" /> <!-- part of the installer file name -->
  <variable name="version" value="1.6.0_27" />
  <variable name="last" value="27" /> <!-- last part of the version - used for looping through installed versions -->

  <check type="uninstall" condition="exists" path="Java(TM) 6 Update %last%" />
  <check type="uninstall" condition="exists" path="Java(TM) 6 Update %last% (64-bit)" architecture="x64" />
  <check type="file" condition="exists" path="%PROGRAMFILES%\Java\jre6\bin\javacpl.exe" />

  <install cmd='net stop JavaQuickStarterService'>
    <exit code="2" />
  </install>
  <install cmd='%COMSPEC% /C FOR /L %I IN (0,1,9)       DO msiexec %MSI% /x {3248F0A8-6813-11D6-A77B-00B0D01600%I0}'><exit code='1605' /></install>
  <install cmd='%COMSPEC% /C FOR /L %I IN (10,1,20) DO msiexec %MSI% /x {26A24AE4-039D-4CA4-87B4-2F832160%IFF}'> <exit code='1605' /></install>
  <install cmd='%COMSPEC% /C FOR /L %I IN (21,1,%last%) DO msiexec %MSI% /x {26A24AE4-039D-4CA4-87B4-2F832160%IFF}'> <exit code='1605' /></install>
  <install cmd='%COMSPEC% /C FOR /L %I IN (10,1,20) DO msiexec %MSI% /x {26A24AE4-039D-4CA4-87B4-2F864160%IFF}' architecture="x64"> <exit code='1605' /></install>
  <install cmd='%COMSPEC% /C FOR /L %I IN (21,1,%last%) DO msiexec %MSI% /x {26A24AE4-039D-4CA4-87B4-2F864160%IFF}' architecture="x64"> <exit code='1605' /></install>
  <install cmd='msiexec %MSI% /i "%SOFTWARE%\Java\x86\jre%version%.msi"  ADDLOCAL=ALL IEXPLORER=1 MOZILLA=1 REBOOT=Suppress'>
    <exit code="3010" reboot="false" />
    <exit code="0" />
  </install>
  <install cmd='"%SOFTWARE%\Java\amd64\jre-%short%-windows-x64.exe" /s ADDLOCAL=ALL IEXPLORER=1 MOZILLA=1 REBOOT=Suppress' architecture="x64">
    <exit code="3010" reboot="false" />
    <exit code="0" />
  </install>
  <install cmd='REG ADD "HKLM\SOFTWARE\JavaSoft\Java Update\Policy" /v EnableAutoUpdateCheck /t REG_DWORD /d 0 /f' />
  <install cmd='REG ADD "HKLM\SOFTWARE\JavaSoft\Java Update\Policy" /v EnableJavaUpdate /t REG_DWORD /d 0 /f' />
  <install cmd='REG ADD "HKLM\SOFTWARE\JavaSoft\Java Runtime Environment\%version%" /v JavaHome /d "%PROGRAMFILES%\Java\jre6" /f' />
  <install cmd='REG ADD "HKLM\SOFTWARE\JavaSoft\Java Plug-in\%version%" /v JavaHome /d "%PROGRAMFILES%\Java\jre6" /f' />
  <install cmd='REG ADD "HKLM\SOFTWARE\JavaSoft\Java Web Start\%version%" /v JavaHome /d "%PROGRAMFILES%\Java\jre6" /f' />
  <install cmd='"%PROGRAMFILES%\Java\jre6\bin\jqs.exe" -unregister'><exit code='1' /></install>
  <install cmd='"%PROGRAMFILES(x86)%\Java\jre6\bin\jqs.exe" -unregister' architecture="x64"><exit code='1' /></install>
  <install cmd='REG DELETE "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run" /v "SunJavaUpdateSched" /f'>
    <exit code="1" />
  </install>
  <install cmd='net stop JavaQuickStarterService'>
    <exit code="2" />
  </install>

  <upgrade cmd='net stop JavaQuickStarterService'>
    <exit code="2" />
  </upgrade>
  <upgrade cmd='%COMSPEC% /C FOR /L %I IN (0,1,9)       DO msiexec %MSI% /x {3248F0A8-6813-11D6-A77B-00B0D01600%I0}'><exit code='1605' /></upgrade>
  <upgrade cmd='%COMSPEC% /C FOR /L %I IN (10,1,20) DO msiexec %MSI% /x {26A24AE4-039D-4CA4-87B4-2F832160%IFF}'> <exit code='1605' /></upgrade>
  <upgrade cmd='%COMSPEC% /C FOR /L %I IN (21,1,%last%) DO msiexec %MSI% /x {26A24AE4-039D-4CA4-87B4-2F832160%IFF}'> <exit code='1605' /></upgrade>
  <upgrade cmd='%COMSPEC% /C FOR /L %I IN (10,1,20) DO msiexec %MSI% /x {26A24AE4-039D-4CA4-87B4-2F864160%IFF}' architecture="x64"> <exit code='1605' /></upgrade>
  <upgrade cmd='%COMSPEC% /C FOR /L %I IN (21,1,%last%) DO msiexec %MSI% /x {26A24AE4-039D-4CA4-87B4-2F864160%IFF}' architecture="x64"> <exit code='1605' /></upgrade>
  <upgrade cmd='msiexec %MSI% /i "%SOFTWARE%\Java\x86\jre%version%.msi"  ADDLOCAL=ALL IEXPLORER=1 MOZILLA=1 REBOOT=Suppress'>
    <exit code="3010" reboot="false" />
    <exit code="0" />
  </upgrade>
  <upgrade cmd='"%SOFTWARE%\Java\amd64\jre-%short%-windows-x64.exe" /s ADDLOCAL=ALL IEXPLORER=1 MOZILLA=1 REBOOT=Suppress' architecture="x64">
    <exit code="3010" reboot="false" />
    <exit code="0" />
  </upgrade>
  <upgrade cmd='REG ADD "HKLM\SOFTWARE\JavaSoft\Java Update\Policy" /v EnableAutoUpdateCheck /t REG_DWORD /d 0 /f' />
  <upgrade cmd='REG ADD "HKLM\SOFTWARE\JavaSoft\Java Update\Policy" /v EnableJavaUpdate /t REG_DWORD /d 0 /f' />
  <upgrade cmd='REG ADD "HKLM\SOFTWARE\JavaSoft\Java Runtime Environment\%version%" /v JavaHome /d "%PROGRAMFILES%\Java\jre6" /f' />
  <upgrade cmd='REG ADD "HKLM\SOFTWARE\JavaSoft\Java Plug-in\%version%" /v JavaHome /d "%PROGRAMFILES%\Java\jre6" /f' />
  <upgrade cmd='REG ADD "HKLM\SOFTWARE\JavaSoft\Java Web Start\%version%" /v JavaHome /d "%PROGRAMFILES%\Java\jre6" /f' />
  <upgrade cmd='"%PROGRAMFILES%\Java\jre6\bin\jqs.exe" -unregister'><exit code='1' /></upgrade>
  <upgrade cmd='"%PROGRAMFILES(x86)%\Java\jre6\bin\jqs.exe" -unregister' architecture="x64"><exit code='1' /></upgrade>
  <upgrade cmd='REG DELETE "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run" /v "SunJavaUpdateSched" /f'>
    <exit code="1" />
  </upgrade>
  <upgrade cmd='net stop JavaQuickStarterService'>
    <exit code="2" />
  </upgrade>

  <downgrade cmd='net stop JavaQuickStarterService'>
    <exit code="2" />
  </downgrade>
  <downgrade cmd='%COMSPEC% /C FOR /L %I IN (0,1,9)       DO msiexec %MSI% /x {3248F0A8-6813-11D6-A77B-00B0D01600%I0}'><exit code='1605' /></downgrade>
  <downgrade cmd='%COMSPEC% /C FOR /L %I IN (10,1,20) DO msiexec %MSI% /x {26A24AE4-039D-4CA4-87B4-2F832160%IFF}'> <exit code='1605' /></downgrade>
  <downgrade cmd='%COMSPEC% /C FOR /L %I IN (21,1,%last%) DO msiexec %MSI% /x {26A24AE4-039D-4CA4-87B4-2F832160%IFF}'> <exit code='1605' /></downgrade>
  <downgrade cmd='%COMSPEC% /C FOR /L %I IN (10,1,20) DO msiexec %MSI% /x {26A24AE4-039D-4CA4-87B4-2F864160%IFF}' architecture="x64"> <exit code='1605' /></downgrade>
  <downgrade cmd='%COMSPEC% /C FOR /L %I IN (21,1,%last%) DO msiexec %MSI% /x {26A24AE4-039D-4CA4-87B4-2F864160%IFF}' architecture="x64"> <exit code='1605' /></downgrade>
  <downgrade cmd='msiexec %MSI% /i "%SOFTWARE%\Java\x86\jre%version%.msi"  ADDLOCAL=ALL IEXPLORER=1 MOZILLA=1 REBOOT=Suppress'>
    <exit code="3010" reboot="false" />
    <exit code="0" />
  </downgrade>
  <downgrade cmd='"%SOFTWARE%\Java\amd64\jre-%short%-windows-x64.exe" /s ADDLOCAL=ALL IEXPLORER=1 MOZILLA=1 REBOOT=Suppress' architecture="x64">
    <exit code="3010" reboot="false" />
    <exit code="0" />
  </downgrade>
  <downgrade cmd='REG ADD "HKLM\SOFTWARE\JavaSoft\Java Update\Policy" /v EnableAutoUpdateCheck /t REG_DWORD /d 0 /f' />
  <downgrade cmd='REG ADD "HKLM\SOFTWARE\JavaSoft\Java Update\Policy" /v EnableJavaUpdate /t REG_DWORD /d 0 /f' />
  <downgrade cmd='REG ADD "HKLM\SOFTWARE\JavaSoft\Java Runtime Environment\%version%" /v JavaHome /d "%PROGRAMFILES%\Java\jre6" /f' />
  <downgrade cmd='REG ADD "HKLM\SOFTWARE\JavaSoft\Java Plug-in\%version%" /v JavaHome /d "%PROGRAMFILES%\Java\jre6" /f' />
  <downgrade cmd='REG ADD "HKLM\SOFTWARE\JavaSoft\Java Web Start\%version%" /v JavaHome /d "%PROGRAMFILES%\Java\jre6" /f' />
  <downgrade cmd='"%PROGRAMFILES%\Java\jre6\bin\jqs.exe" -unregister'><exit code='1' /></downgrade>
  <downgrade cmd='"%PROGRAMFILES(x86)%\Java\jre6\bin\jqs.exe" -unregister' architecture="x64"><exit code='1' /></downgrade>
  <downgrade cmd='REG DELETE "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run" /v "SunJavaUpdateSched" /f'>
    <exit code="1" />
  </downgrade>
  <downgrade cmd='net stop JavaQuickStarterService'>
    <exit code="2" />
  </downgrade>

  <remove cmd='net stop JavaQuickStarterService'>
    <exit code="1060" />
  </remove>
  <remove cmd='msiexec %MSI% /X{26A24AE4-039D-4CA4-87B4-2F832160%last%FF}'>
    <exit code="1605" />
    <exit code="3010" />
  </remove>
  <remove cmd='msiexec %MSI% /X{26A24AE4-039D-4CA4-87B4-2F864160%last%FF}' architecture="x64">
    <exit code="1605" />
    <exit code="3010" />
  </remove>

</package>

</packages>

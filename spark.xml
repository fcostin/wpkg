<?xml version="1.0" encoding="UTF-8"?>

<packages>

  <!--
  NOTES
  1) http://www.igniterealtime.org/projects/spark/index.jsp
  2) For some super odd reason, Spark needs to be start once as admin before normal users can start it, so we do that and kill it again on install
  -->

<package
  id="spark"
  name="Spark IM"
  revision="%version%-0"
  reboot="false"
  priority="10">

  <check type="uninstall" condition="versiongreaterorequal" path="Spark" value="2.5.8" />

  <install cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "x86" msiexec /i "%SOFTWARE%\SparkIM\spark_2_5_8_online.msi" %MSI%' />
  <install cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" msiexec /i "%SOFTWARE%\SparkIM\spark_2_5_8_online.msi" %MSI%' />
  <install cmd='%COMSPEC% /C IF EXIST "%PROGRAMFILES%\Spark\Spark.exe" "%PROGRAMFILES%\Spark\Spark.exe"' />
  <install cmd='%COMSPEC% /C IF EXIST "%PROGRAMFILES(x86)%\Spark\Spark.exe" "%PROGRAMFILES%\Spark\Spark.exe"' />
  <install cmd='taskkill /f /im spark.exe'><exit code="any" /></install>

  <upgrade cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "x86" msiexec /i "%SOFTWARE%\SparkIM\spark_2_5_8_online.msi" %MSI%' />
  <upgrade cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" msiexec /i "%SOFTWARE%\SparkIM\spark_2_5_8_online.msi" %MSI%' />

  <downgrade cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "x86" msiexec /i "%SOFTWARE%\SparkIM\spark_2_5_8_online.msi" %MSI%' />
  <downgrade cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" msiexec /i "%SOFTWARE%\SparkIM\spark_2_5_8_online.msi" %MSI%' />

  <remove  cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "x86" msiexec /x "%SOFTWARE%\SparkIM\spark_2_5_8_online.msi" %MSI%' />
  <remove  cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" msiexec /x "%SOFTWARE%\SparkIM\spark_2_5_8_online.msi" %MSI%' />

</package>

</packages>
